<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-inherit="point_of_sale.ClosePosPopup" t-inherit-mode="extension">
        <xpath expr="//div[hasclass('total-orders')]//span[hasclass('amount')]" position="after">
            <t t-if="pos.config.show_currency_rate!=0">
                <t t-set="trm" t-value="1/pos.config.show_currency_rate"/>
            </t>
            <t t-else="">
                <t t-set="trm" t-value="1"/>
            </t>
            <t t-if="trm!=0">
            <span style="color: red;">/</span>
                <span style="color: red;" t-esc="pos.format_currency_ref(props.orders_details.amount / trm)"/>
            </t>
        </xpath>
        
        <xpath expr="//span[@t-esc='env.utils.formatCurrency(props.default_cash_details.opening)']" position="after">
            <t t-if="trm!=0">
                <span style="color: red;">/</span>
                <span style="color: red;"
                      t-esc="pos.format_currency_ref(Math.abs(props.default_cash_details.opening) / trm)"/>
            </t>
        </xpath>

        <xpath expr="//div[hasclass('payment-methods-overview')]//div[hasclass('text-muted')][contains(.,'Expected')]" position="after">
             <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2">
                 <span>Reference Expected</span>
                 <span style="color: red;" t-esc="pos.format_currency_ref(props.default_cash_details.default_cash_details_ref.amount)"/>
             </div>
        </xpath>

        <!-- MoneyDetailsPopupUSD remains similar but check if it needs update -->
        <xpath expr="//Dialog" position="after">
            <MoneyDetailsPopupUSD
                    t-if="state.displayMoneyDetailsPopupUSD"
                    manualInputCashCountUSD="manualInputCashCountUSD"
                    onConfirm.bind="updateCountedCashUSD"
                    onDiscard.bind="closeDetailsPopupUSD"
            />
        </xpath>

        <!-- Updating difference display for cash -->
        <xpath expr="//span[hasclass('cash-difference')]" position="after">
             <t t-if="trm!=0">
                <span style="color: red;"> / </span>
                <span style="color: red;" t-esc="pos.format_currency_ref(state.payments_usd[props.default_cash_details.default_cash_details_ref.id].difference)"/>
            </t>
        </xpath>

        <!-- Updating non-cash methods -->
        <xpath expr="//div[@t-foreach='props.non_cash_payment_methods']//span[@t-esc='env.utils.formatCurrency(pm.amount)']" position="after">
            <t t-if="trm!=0">
                <span style="color: red;">/</span>
                <span style="color: red;" t-esc="pos.format_currency_ref(pm.amount/trm)"/>
            </t>
        </xpath>
    </t>
</templates>
