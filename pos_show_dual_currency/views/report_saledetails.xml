<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="pos_daily_report" inherit_id="point_of_sale.pos_session_sales_details">
        
        <!-- 1. Columna de Título: La agregaremos a la fila de categoría ya que no hay thead -->
        <xpath expr="//div[@id='sales']//tr[@t-foreach='products']//td[last()]" position="after">
            <td class="text-end fw-bold">
                <span style="color: red">
                    <t t-out="symbol_ref"/>
                    <t t-out="category['total_ref']" t-options="{'widget': 'float', 'precision': currency_precision_ref}"/>
                </span>
            </td>
        </xpath>

        <!-- 2. Columna de Precio Ref en la fila de producto -->
        <xpath expr="//tr[@t-foreach=&quot;category['products']&quot;]//td[last()]" position="after">
            <td class="text-end">
                <span style="color: red">
                    <t t-out="symbol_ref"/>
                    <t t-out="line['price_unit_ref']" t-options="{'widget': 'float', 'precision': currency_precision_ref}"/>
                </span>
            </td>
        </xpath>

        <!-- 3. Totales de Ventas (Inside the Total row td) -->
        <xpath expr="//div[@id='sales']//table//tbody/tr[not(@t-foreach)]/td[last()]" position="inside">
            /
            <span style="color: red">
                <t t-out="symbol_ref"/>
                <t t-out="products_info['total_ref']"
                   t-options="{'widget': 'float', 'precision': currency_precision_ref}"/>
            </span>
        </xpath>

        <!-- 4. Impuestos (Sales) -->
        <xpath expr="//div[@id='taxe_sales']//tr[@t-foreach='taxes']" position="replace">
            <tr t-foreach="taxes" t-as="tax" class="border-bottom border-secondary">
                <td class="ps-2 fw-bold"><span t-out="tax['name']"/></td>
                <td class="text-end">
                    <t t-out="tax['tax_amount']" t-options="{'widget': 'float', 'precision': currency['precision']}"/>
                    <t t-out="currency['symbol']"/>
                    /
                    <span style="color: red">
                        <t t-out="symbol_ref"/>
                        <t t-out="tax['tax_amount_ref']"
                           t-options="{'widget': 'float', 'precision': currency_precision_ref}"/>
                    </span>
                </td>
                <td class="text-end">
                    <t t-out="tax['base_amount']" t-options="{'widget': 'float', 'precision': currency['precision']}"/>
                    <t t-out="currency['symbol']"/>
                    /
                    <span style="color: red">
                        <t t-out="symbol_ref"/>
                        <t t-out="tax['base_amount_ref']"
                           t-options="{'widget': 'float', 'precision': currency_precision_ref}"/>
                    </span>
                </td>
            </tr>
        </xpath>

        <!-- 5. Bucle de Pagos (Session Control - Bottom) -->
        <xpath expr="//t[@t-foreach='payments']" position="replace">
            <t t-foreach="payments" t-as="method">
                <t t-if="method['count']">
                    <tr>
                        <td><strong><span t-out="method['name']"/></strong></td>
                        <td/>
                        <td class="text-end">
                            <span t-if="currency['position']">
                                <span t-out="method['final_count']" t-options="{'widget': 'float', 'precision': currency['precision']}"/>
                                <span t-out="currency['symbol']"/>
                            </span>
                            <span t-else="">
                                <span t-out="currency['symbol']"/>
                                <span t-out="method['final_count']" t-options="{'widget': 'float', 'precision': currency['precision']}"/>
                            </span>
                            /
                            <span style="color: red">
                                <t t-out="symbol_ref"/>
                                <t t-out="method['total_ref']"
                                    t-options="{'widget': 'float', 'precision': currency_precision_ref}"/>
                            </span>
                        </td>
                        <td t-if="(state == 'closed' or state == 'multiple') and payments" class="text-end">
                            <span t-out="method['money_counted']" t-options="{'widget': 'float', 'precision': currency['precision']}"/>
                        </td>
                        <td t-if="(state == 'closed' or state == 'multiple') and payments" class="text-end">
                            <span t-out="method['money_difference']" t-options="{'widget': 'float', 'precision': currency['precision']}"/>
                        </td>
                    </tr>
                </t>
            </t>
        </xpath>

    </template>
</odoo>